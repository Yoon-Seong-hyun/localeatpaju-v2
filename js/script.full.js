
// Translation Data
const translations = {
     ko: {
          nav_home: "홈",
          nav_market: "마켓",
          nav_story: "브랜드 스토리",
          nav_farm: "체험",
          nav_camping: "캠핑",
          login: "로그인",
          signup: "회원가입",
          hero_subtitle: "Premium Local Food Market",
          hero_title: "자연의 시간이<br>맛이 되는 곳",
          hero_desc: "새벽 이슬을 머금은 대지의 생명력.<br>오늘 아침 파주의 흙내음이 당신의 식탁 위에 가장 신선한 미식으로 도착합니다.",
          btn_market: "지금 쇼핑하기",
          btn_story: "Brand Story",
          value_tag: "OUR VALUES",
          value_title: "로컬잇파주가 식탁에 전하는 약속",
          value_desc: "우리는 상품이 아닌 자연의 시간을 전합니다.<br>땅과 사람, 그리고 당신의 식탁을 잇는 진정성 있는 이야기를 만나보세요.",
          feat_1_title: "새벽의 이슬을 머금은 채<br>당신의 식탁으로",
          feat_1_text: "<strong>당일 수확, 당일 도착의 원칙</strong><br>오늘 아침 수확, 오늘 저녁 식탁.<br>파주 내 100% 당일 수확 및 배송을 원칙으로 합니다. 긴 유통 과정에서 잃어버리기 쉬운 맛과 영양을 그대로 지킵니다.",
          feat_1_link: "운영 정책 보기",
          feat_2_title: "이름을 건다는 것은<br>품질을 약속한다는 것",
          feat_2_text: "<strong>파머스 프라이드, 경작 실명제</strong><br>누가, 어디서, 어떻게 길렀는지 숨기지 않습니다.<br>모든 상품에는 농부의 얼굴과 이름, 작물에 쏟은 정성이 담긴 '영농일지' QR코드가 함께합니다.",
          feat_3_title: "자연의 리듬을 배우는 시간",
          feat_3_text: "<strong>흙을 만지며 자라는 아이들의 감성</strong><br>먹는 즐거움을 넘어 기르는 기쁨까지.<br>주말 농장 분양부터 제철 수확 프로그램까지, 흙을 만지며 자연과 교감하는 소중한 추억을 선물합니다.",
          feat_3_link: "체험 예약하기",
          p_stat_tag: "SMART CHOICE",
          p_stat_price_title: "오늘의 가격,<br>투명하게 비교하세요.",
          p_stat_desc: "농림축산식품부와 aT(한국농수산식품유통공사)가 제공하는 <strong style='color: var(--color-primary);'>KAMIS(농산물유통정보)</strong> 데이터를 실시간으로 확인해드립니다.<br><br>중간 유통 단계가 없는 로컬푸드가 얼마나 합리적인지, 직접 눈으로 확인하고 구매하세요. 농부에게는 제값을, 소비자에게는 만족을 드립니다.",
          p_stat_market: "일반 유통 평균",
          p_stat_local: "로컬잇파주",
          p_stat_zero: "0단계 (직거래)",
          loading_msg: "실시간 시세 정보를 불러오는 중...",
          curation_tag: "LIFESTYLE CURATION",
          curation_title: "DMZ가 제안하는<br>건강한 라이프스타일",
          curation_desc: "청정 자연의 에너지를 담은 로컬잇파주만의 특별한 제안.<br>당신의 하루를 더욱 가치 있게 만들어 드립니다.",
          curation_1_title: "속편한 비건 디저트",
          curation_1_desc: "우유, 버터 없이도 충분히 달콤합니다. 파주 장단콩의 진한 고소함을 가득 채운 비건 베이커리를 만나보세요.",
          curation_2_title: "마시는 이너뷰티",
          curation_2_desc: "감악산 야생 칡과 장단 마의 생명력을 한 컵에 담았습니다. 바쁜 아침, 당신의 위장과 피부를 지켜주는 건강한 습관.",
          curation_3_title: "로컬 홈파티",
          curation_3_desc: "산머루 와인으로 만드는 뱅쇼, 달콤한 사과 약과. 평범한 저녁 식탁을 특별한 파티로 바꿔줄 파주의 맛.",
          exp_tag: "SPECIAL EXPERIENCE",
          exp_title: "파주의 풍경 속에 머무는<br>프라이빗한 여정",
          exp_desc: "단순한 소비가 아닌, 삶의 영감이 되는 로컬 여행.<br>소중한 사람과 함께 파주의 깊은 매력을 향유하세요.",
          farmer_tag: "파주의 땅에 내일의 씨앗을 심는 사람들",
          farmer_title: "\"나보다 못난이라도 괜찮아,<br>농약은 안먹고 자랐으니까..\"",
          farmer_desc: "매끈하지 않아도 괜찮습니다. 자연이 허락한 모습 그대로니까요. 한 입 베어 물면 퍼지는 짙은 향기, 그것은 인위적인 손길이 닿지 않았다는 가장 확실한 증거입니다.",
          farmer_btn_interview: "인터뷰 전문 보기",
          farmer_btn_buy: "못난이 사과 구매하기",
          export_tag: "K-WELLNESS GLOBAL PROJECT",
          export_title: "파주의 헤리티지(Heritage),<br>세계의 미식으로 깨어나다",
          export_desc: "파주의 흙과 바람이 키워낸 로컬의 깊이. 투박했던 토종 식재료가 섬세한 레시피와 만나<br>세계 어디서나 사랑받는 세련된 디저트와 음료로 다시 태어납니다.",
          export_btn: "글로벌 관 구경하기",
          export_p1: "장단콩 두부과자",
          export_p1_desc: "미국/일본 수출",
          export_p2: "개성인삼 젤리스틱",
          export_p2_desc: "동남아 3국 수출",
          export_p3: "산머루 스파클링",
          export_p3_desc: "유럽 수출 예정",
          export_p4: "한수위 김치",
          export_p4_desc: "비건 인증 획득",
          season_tag: "SEASONAL PICK",
          season_title: "계절이 선물한<br>미식의 절정(Climax)",
          season_more_btn: "전체 상품 보기",
          review_title: "#로컬잇파주 후기",
          review_desc: "식탁에 도착한 파주의 신선함을 공유해주세요.",
          footer_desc: "로컬잇파주는 파주시 청년 농부들이 함께 만드는<br>로컬푸드 상생 프로젝트입니다.",
          footer_link_story: "브랜드 스토리",
          footer_link_terms: "이용약관",
          footer_link_privacy: "개인정보처리방침",
          footer_link_inquiry: "입점/제휴 문의",
          footer_info: "경기도 파주시 평화로 123 (문산읍) 1층 | 대표: 윤성현<br>사업자등록번호: 000-00-00000 | 통신판매업신고: 2024-파주-0000<br>COPYRIGHT © 2024 LOCALeatPAJU. ALL RIGHTS RESERVED.",
          ai_title: "당신의 취향을 읽는<br>프라이빗 푸드 컨시어지",
          ai_desc: "오늘의 기분과 취향에 가장 어울리는 파주의 맛을 제안합니다.<br>당신만을 위한 미식 큐레이션을 경험해 보세요.",
          ai_tab_chef: "장바구니 셰프",
          ai_tab_gift: "선물 큐레이터",
          ai_chef_guide: "장바구니 속 재료(또는 냉장고에 있는) 재료를 선택해주세요.",
          ing_bean: "장단콩",
          ing_rice: "한수위 쌀",
          ing_ginseng: "개성인삼",
          ing_yam: "장단 마",
          ing_wine: "산머루 와인",
          ing_honey: "DMZ 꿀",
          btn_recipe: "레시피 추천받기",
          gift_target_default: "누구에게 선물하세요?",
          target_parents: "부모님 / 어르신",
          target_friend: "친구 / 직장동료",
          target_couple: "연인 / 배우자",
          target_kids: "아이 / 조카",
          gift_occasion_default: "어떤 상황인가요?",
          occasion_health: "건강 챙김",
          occasion_party: "홈파티",
          occasion_snack: "가벼운 간식",
          occasion_holiday: "명절 / 기념일",
          btn_find_gift: "맞춤 선물 찾기",
          ai_analyzing: "AI가 최적의 조합을 분석 중입니다...",
          time_sale_badge: "타임세일",
          ugly_market_title: "마감 임박! 못난이 마켓",
          ugly_market_desc: "맛과 영양은 그대로, 가격은 파격! 가치 소비에 동참하세요.",
          ugly_item_name: "파주 못난이 사과 5kg",
          time_left: "남은 시간:",
          btn_ugly_buy: "지금 구출하기",
          group_buy_badge: "공동구매",
          group_buy_title: "월간 수확! 공동구매",
          group_buy_desc: "뭉치면 싸진다. 목표 달성 시 산지에서 바로 집으로 출발.",
          group_item_name: "고랭지 배추 100포기 키트",
          group_status: "현재 85명 참여",
          group_target: "100명 달성 시 마감",
          btn_group_join: "공구 참여하기",
          sub_tag: "MONTHLY PAJU",
          sub_title: "제철 큐레이션 구독<br>'월간 파주'",
          sub_desc: "고민하지 마세요. 가장 맛있는 파주의 제철 식재료와<br>셰프의 레시피 카드를 매달 집으로 보내드립니다.",
          btn_sub_start: "구독 시작하기",
          btn_sub_details: "이달의 구성 보기",
          sub_box_title: "4월의 파주 박스",
          sub_item_1: "봄나물 3종 키트",
          sub_item_2: "친환경 딸기 500g",
          sub_item_3: "AI 셰프 레시피 카드"
     },
     en: {
          nav_home: "Home",
          nav_market: "Market",
          nav_story: "Brand Story",
          nav_farm: "Experience",
          nav_camping: "Camping",
          login: "Log In",
          signup: "Sign Up",
          hero_subtitle: "Premium Local Food Market",
          hero_title: "Nature's Time<br>Becomes Flavor",
          hero_desc: "Freshness from the nearest distance.<br>Delivered from the farmer's hands to your table this morning.",
          btn_market: "Shop Now",
          btn_story: "Brand Story",
          value_tag: "OUR VALUES",
          value_title: "Why 'LocaleatPaju'?",
          value_desc: "Not just selling produce. <br>We deliver stories connecting nature, people, and your table.",
          feat_1_title: "24h Delivery",
          feat_1_text: "Picked this morning, on your table by dinner.<br>100% same-day harvest and delivery within Paju. We preserve the taste and nutrition often lost in long distribution processes.",
          feat_1_link: "View Policy",
          feat_2_title: "Transparent Farmer ID",
          feat_2_text: "We don't hide who, where, or how it was grown.<br>All products include a 'Farming Log' QR code with the farmer's face, name, and the care poured into the crops.",
          feat_3_title: "5-Senses Experience",
          feat_3_text: "Beyond eating, the joy of growing.<br>Offering weekend farm lots and seasonal harvest programs for cherished memories of touching the soil.",
          feat_3_link: "Book Experience",
          p_stat_tag: "SMART CHOICE",
          p_stat_price_title: "Today's Price,<br>Compare Transparently.",
          p_stat_desc: "Check real-time <strong style='color: var(--color-primary);'>KAMIS</strong> data provided by the Ministry of Agriculture and aT.<br><br>See how reasonable local food prices are without middlemen. Fair prices for farmers, satisfaction for consumers.",
          p_stat_market: "General Retail",
          p_stat_local: "LocaleatPaju",
          p_stat_zero: "Level 0 (Direct)",
          loading_msg: "Loading real-time market prices...",
          curation_tag: "LIFESTYLE CURATION",
          curation_title: "Healthy Lifestyle<br>Suggested by DMZ",
          curation_desc: "Special proposals from LocaleatPaju containing the energy of clean nature.<br>We make your day more valuable.",
          curation_1_title: "Comfort Vegan Dessert",
          curation_1_desc: "Sweet enough without milk or butter. Meet vegan bakery items filled with the rich nuttiness of Paju Jangdan Soybeans.",
          curation_2_title: "Drinking Inner Beauty",
          curation_2_desc: "Gamaksan wild arrowroot and Jangdan yam vitality in a cup. A healthy habit protecting your stomach and skin every morning.",
          curation_3_title: "Local Home Party",
          curation_3_desc: "Vin Chaud made with Sanmeoru Wine, sweet Apple Soy Yakgwa. Paju's flavors transforming an ordinary dinner into a special party.",
          exp_tag: "SPECIAL EXPERIENCE",
          exp_title: "A Special Day<br>Enjoyed in Paju",
          exp_desc: "Local travel completed by experience beyond simple purchase.<br>Leave for Paju with your loved ones this weekend.",
          farmer_tag: "MONTHLY FARMER",
          farmer_title: "\"Ugly Fruits?<br>Grown Without Pesticides\"",
          farmer_desc: "Farmer <b style='color: #333;'>Kim Cheol-su</b>, farming apples for 40 years in Munsan-eup, Paju.<br>He says the apples that withstood this year's harsh wind and rain are praiseworthy. Though rough in shape, the deep flavor spreading in your mouth when bitten peel and all cannot be compared to department store fruits.",
          farmer_btn_interview: "Read Full Interview",
          farmer_btn_buy: "Buy Ugly Apples",
          export_tag: "K-WELLNESS GLOBAL PROJECT",
          export_title: "Flavor of Paju, To the World",
          export_desc: "From <strong>Tofu Snacks</strong> using Jangdan beans to Ginseng Jelly.<br>We process Paju's specialties to captivate global tastes.",
          export_btn: "Visit Global Hall",
          export_p1: "Jangdan Bean Tofu Snack",
          export_p1_desc: "Export to USA/Japan",
          export_p2: "Gaeseong Ginseng Jelly Stick",
          export_p2_desc: "Export to SE Asia",
          export_p3: "Sanmeoru Sparkling",
          export_p3_desc: "Export to Europe Planned",
          export_p4: "Hansuwi Kimchi",
          export_p4_desc: "Vegan Certified",
          season_tag: "SEASONAL PICK",
          season_title: "Most Delicious Right Now",
          season_more_btn: "View All Products",
          review_title: "#LocaleatPaju Reviews",
          review_desc: "Share the freshness of Paju arriving at your table.",
          footer_desc: "LocaleatPaju is a local food win-win project<br>created by young farmers in Paju.",
          footer_link_story: "Brand Story",
          footer_link_terms: "Terms of Service",
          footer_link_privacy: "Privacy Policy",
          footer_link_inquiry: "Parnership Inquiry",
          footer_info: "1F, 123 Pyeonghwa-ro, Munsan-eup, Paju-si, Gyeonggi-do | CEO: Paju Kim<br>Business Reg: 000-00-00000 | E-commerce Permit: 2024-Paju-0000<br>COPYRIGHT © 2024 LOCALeatPAJU. ALL RIGHTS RESERVED.",
          ai_title: "Smart Local Life",
          ai_desc: "Wondering what to eat or gift?<br>AI suggests options fitting your taste and situation.",
          ai_tab_chef: "Cart Chef",
          ai_tab_gift: "Gift Curator",
          ai_chef_guide: "Select ingredients in your cart (or fridge).",
          ing_bean: "Jangdan Bean",
          ing_rice: "Hansuwi Rice",
          ing_ginseng: "Gaeseong Ginseng",
          ing_yam: "Jangdan Yam",
          ing_wine: "Sanmeoru Wine",
          ing_honey: "DMZ Honey",
          btn_recipe: "Get Recipe",
          gift_target_default: "Who is this gift for?",
          target_parents: "Parents / Elders",
          target_friend: "Friend / Colleague",
          target_couple: "Lover / Spouse",
          target_kids: "Child / Niece/Nephew",
          gift_occasion_default: "What is the occasion?",
          occasion_health: "Health Care",
          occasion_party: "Home Party",
          occasion_snack: "Light Snack",
          occasion_holiday: "Holiday / Anniversary",
          btn_find_gift: "Find Perfect Gift",
          ai_analyzing: "AI is analyzing the best combination...",
          time_sale_badge: "Time Sale",
          ugly_market_title: "Closing Soon! Ugly Market",
          ugly_market_desc: "Same taste and nutrition, shocking price! Join value consumption.",
          ugly_item_name: "Paju Ugly Apple 5kg",
          time_left: "Time Left:",
          btn_ugly_buy: "Rescue Now",
          group_buy_badge: "Group Buy",
          group_buy_title: "Monthly Harvest! Group Buy",
          group_buy_desc: "Cheaper together. Shipping starts directly from farm when goal reached.",
          group_item_name: "Highland Cabbage 100 Heads Kit",
          group_status: "85 Participating",
          group_target: "Close at 100",
          btn_group_join: "Join Group Buy",
          sub_tag: "MONTHLY PAJU",
          sub_title: "Seasonal Curation Subscription<br>'Monthly Paju'",
          sub_desc: "Don't worry. We send Paju's most delicious seasonal ingredients<br>and chef's recipe cards to your home every month.",
          btn_sub_start: "Start Subscription",
          btn_sub_details: "View This Month's Kit",
          sub_box_title: "April Paju Box",
          sub_item_1: "Spring Greens 3-Type Kit",
          sub_item_2: "Eco-friendly Strawberry 500g",
          sub_item_3: "AI Chef Recipe Card"
     },
     jp: {
          nav_home: "ホーム",
          nav_market: "マーケット",
          nav_story: "ブランドストーリー",
          nav_farm: "体験",
          nav_camping: "キャンプ",
          login: "ログイン",
          signup: "会員登録",
          hero_subtitle: "Premium Local Food Market",
          hero_title: "自然の時間が<br>味になる場所",
          hero_desc: "最も近い距離から届ける新鮮さ。<br>今朝の農家の手が一あなたの食卓へと繋がります。",
          btn_market: "今すぐショッピング",
          btn_story: "Brand Story",
          value_tag: "OUR VALUES",
          value_title: "なぜ「ローカルイート坡州」なのか？",
          value_desc: "単に農産物を売るだけではありません。<br>自然と人、そしてあなたの食卓を繋ぐ物語を伝えます。",
          feat_1_title: "24時間配送",
          feat_1_text: "今朝収穫、今晩の食卓。<br>坡州市内100%当日収穫・配送を原則とします。長い流通過程で失われがちな味と栄養をそのまま守ります。",
          feat_1_link: "運営ポリシーを見る",
          feat_2_title: "透明な実名制",
          feat_2_text: "誰が、どこで、どうやって育てたか隠しません。<br>全ての商品には農家の顔と名前、作物に注いだ誠意が込められた「営農日誌」QRコードが付いています。",
          feat_3_title: "五感満足体験",
          feat_3_text: "食べる楽しさを超えて育てる喜びまで。<br>週末農場の分譲から旬の収穫プログラムまで、土に触れて自然と交感する大切な思い出をプレゼントします。",
          feat_3_link: "体験予約",
          p_stat_tag: "SMART CHOICE",
          p_stat_price_title: "今日の価格、<br>透明に比較してください。",
          p_stat_desc: "農林畜産食品部とaT(韓国農水産食品流通公社)が提供する <strong style='color: var(--color-primary);'>KAMIS(農産物流通情報)</strong> データをリアルタイムで確認できます。<br><br>中間流通段階のないローカルフードがどれほど合理的か、直接目で確認して購入してください。農家には適正価格を、消費者には満足を差し上げます。",
          p_stat_market: "一般流通平均",
          p_stat_local: "ローカルイート坡州",
          p_stat_zero: "0段階 (直取引)",
          loading_msg: "リアルタイム相場情報を読み込み中...",
          curation_tag: "LIFESTYLE CURATION",
          curation_title: "DMZが提案する<br>健康なライフスタイル",
          curation_desc: "清浄自然のエネルギーを込めたローカルイート坡州だけの特別な提案。<br>あなたの一日をより価値あるものにします。",
          curation_1_title: "お腹に優しいヴィーガンデザート",
          curation_1_desc: "牛乳、バターなしでも十分に甘いです。坡州長湍豆の濃厚な香ばしさを満たしたヴィーガンベーカリーに出会ってください。",
          curation_2_title: "飲むインナービューティー",
          curation_2_desc: "紺岳山野生葛と長湍長芋の生命力を一杯に込めました。忙しい朝、あなたの胃腸と肌を守る健康習慣。",
          curation_3_title: "ローカルホームパーティー",
          curation_3_desc: "山葡萄ワインで作るヴァンショー、甘いリンゴ薬果。平凡な夕食の食卓を特別なパーティーに変える坡州の味。",
          exp_tag: "SPECIAL EXPERIENCE",
          exp_title: "坡州で楽しむ<br>特別な一日",
          exp_desc: "単純な購買を超えて体験で完成するローカル旅行。<br>今週末、愛する人々と坡州へ出かけてみてください。",
          farmer_tag: "MONTHLY FARMER",
          farmer_title: "「不細工な果物？<br>農薬なしで育つから」",
          farmer_desc: "坡州文山邑で40年間リンゴ農業を営む <b style='color: #333;'>キム・チョルス農家</b>。<br>彼は今年とりわけ酷かった雨風に耐え抜いたリンゴたちが健気だと言います。形は少し無骨でも、皮ごと噛れば口いっぱいに広がる深い風味は百貨店の果物と比較できません。",
          farmer_btn_interview: "インタビュー全文を見る",
          farmer_btn_buy: "不細工リンゴを購入",
          export_tag: "K-WELLNESS GLOBAL PROJECT",
          export_title: "坡州の味、世界へ",
          export_desc: "長湍豆を活用した<strong>豆腐菓子</strong>から高麗人参ゼリーまで。<br>坡州の特産物を加工して世界人の味覚を虜にします。",
          export_btn: "グローバル館を見学",
          export_p1: "長湍豆豆腐菓子",
          export_p1_desc: "米国/日本輸出",
          export_p2: "開城高麗人参ゼリースティック",
          export_p2_desc: "東南アジア3国輸出",
          export_p3: "山葡萄スパークリング",
          export_p3_desc: "欧州輸出予定",
          export_p4: "ハンスウィキムチ",
          export_p4_desc: "ヴィーガン認証獲得",
          season_tag: "SEASONAL PICK",
          season_title: "今一番美味しい",
          season_more_btn: "全商品を見る",
          review_title: "#ローカルイート坡州レビュー",
          review_desc: "食卓に届いた坡州の新鮮さをシェアしてください。",
          footer_desc: "ローカルイート坡州は坡州市の青年農家たちが共に作る<br>ローカルフード共生プロジェクトです。",
          footer_link_story: "ブランドストーリー",
          footer_link_terms: "利用規約",
          footer_link_privacy: "個人情報処理方針",
          footer_link_inquiry: "入店/提携お問い合わせ",
          footer_info: "京畿道坡州市平和路123 (文山邑) 1階 | 代表: キム・パジュ<br>事業者登録番号: 000-00-00000 | 通信販売業申告: 2024-坡州-0000<br>COPYRIGHT © 2024 LOCALeatPAJU. ALL RIGHTS RESERVED.",
          ai_title: "スマート・ローカル・ライフ",
          ai_desc: "何を食べるか、誰に贈るか悩みますか？<br>AIがあなたの好みと状況に合った提案をします。",
          ai_tab_chef: "カートシェフ",
          ai_tab_gift: "ギフトキュレーター",
          ai_chef_guide: "カートの中の材料（または冷蔵庫にある）材料を選択してください。",
          ing_bean: "長湍豆",
          ing_rice: "ハンスウィ米",
          ing_ginseng: "開城高麗人参",
          ing_yam: "長湍長芋",
          ing_wine: "山葡萄ワイン",
          ing_honey: "DMZ蜂蜜",
          btn_recipe: "レシピのおすすめ",
          gift_target_default: "誰への贈り物ですか？",
          target_parents: "両親 / 年配の方",
          target_friend: "友人 / 同僚",
          target_couple: "恋人 / 配偶者",
          target_kids: "子供 / 甥・姪",
          gift_occasion_default: "どのような状況ですか？",
          occasion_health: "健康管理",
          occasion_party: "ホームパーティー",
          occasion_snack: "軽いおやつ",
          occasion_holiday: "名節 / 記念日",
          btn_find_gift: "ぴったりのギフトを探す",
          ai_analyzing: "AIが最適な組み合わせを分析中です...",
          time_sale_badge: "タイムセール",
          ugly_market_title: "締切間近！不細工マーケット",
          ugly_market_desc: "味と栄養はそのまま、価格は破格！価値消費に参加してください。",
          ugly_item_name: "坡州不細工リンゴ 5kg",
          time_left: "残り時間:",
          btn_ugly_buy: "今すぐ救出",
          group_buy_badge: "共同購入",
          group_buy_title: "月刊収穫！共同購入",
          group_buy_desc: "集まれば安くなる。目標達成時、産地から直接自宅へ出発。",
          group_item_name: "高冷地白菜 100株キット",
          group_status: "現在85名参加",
          group_target: "100名達成時締切",
          btn_group_join: "共同購入に参加",
          sub_tag: "MONTHLY PAJU",
          sub_title: "旬のキュレーション購読<br>「月刊坡州」",
          sub_desc: "悩まないでください。最も美味しい坡州の旬の食材と<br>シェフのレシピカードを毎月自宅へお届けします。",
          btn_sub_start: "購読を始める",
          btn_sub_details: "今月の構成を見る",
          sub_box_title: "4月の坡州ボックス",
          sub_item_1: "春のナムル3種キット",
          sub_item_2: "環境にやさしいイチゴ 500g",
          sub_item_3: "AIシェフレシピカード"
     },
     cn: {
          nav_home: "首页",
          nav_market: "市场",
          nav_story: "品牌故事",
          nav_farm: "体验",
          nav_camping: "露营",
          login: "登录",
          signup: "注册",
          hero_subtitle: "Premium Local Food Market",
          hero_title: "自然的时间<br>化作味道之处",
          hero_desc: "从最近的距离传达新鲜。<br>今天早上农夫的手艺将连接到您的餐桌。",
          btn_market: "立即购物",
          btn_story: "Brand Story",
          value_tag: "OUR VALUES",
          value_title: "为什么选择'LocaleatPaju'？",
          value_desc: "不仅仅是销售农产品。<br>我们传递连接自然、人和您的餐桌的故事。",
          feat_1_title: "24小时配送",
          feat_1_text: "今早收获，今晚餐桌。<br>坡州市内原则上100%当日收获及配送。原样保留在漫长流通过程中容易流失的味道和营养。",
          feat_1_link: "查看运营政策",
          feat_2_title: "透明实名制",
          feat_2_text: "不隐瞒是谁、在哪里、如何种植的。<br>所有商品都附有包含农夫面孔和姓名、对作物倾注诚意的'营农日志'二维码。",
          feat_3_title: "五感满足体验",
          feat_3_text: "超越吃的乐趣，体验种植的喜悦。<br>从周末农场租赁到应季收获项目，赠送触摸泥土、与自然交感的珍贵回忆。",
          feat_3_link: "预约体验",
          p_stat_tag: "SMART CHOICE",
          p_stat_price_title: "今天的价格，<br>透明地进行比较。",
          p_stat_desc: "实时确认农林畜产食品部和aT(韩国农水产食品流通公社)提供的 <strong style='color: var(--color-primary);'>KAMIS(农产品流通信息)</strong> 数据。<br><br>请亲眼确认没有中间流通阶段的本地食品是多么合理并购买。给农夫合理的价格，给消费者满足。",
          p_stat_market: "一般流通平均",
          p_stat_local: "LocaleatPaju",
          p_stat_zero: "0阶段 (直销)",
          loading_msg: "正在加载实时行情信息...",
          curation_tag: "LIFESTYLE CURATION",
          curation_title: "DMZ提议的<br>健康生活方式",
          curation_desc: "蕴含清净自然能量的LocaleatPaju独有的特别提议。<br>让您的一天更有价值。",
          curation_1_title: "舒心纯素甜点",
          curation_1_desc: "即使没有牛奶、黄油也足够香甜。请遇见充满坡州长湍豆浓郁香气的纯素烘焙。",
          curation_2_title: "喝的内在美容",
          curation_2_desc: "将绀岳山野生葛和长湍山药的生命力装入一杯中。忙碌的早晨，守护您的肠胃和皮肤的健康习惯。",
          curation_3_title: "本地家庭派对",
          curation_3_desc: "用山葡萄红酒制作的热红酒，香甜的苹果药果。将平凡的晚餐餐桌变成特别派对的坡州味道。",
          exp_tag: "SPECIAL EXPERIENCE",
          exp_title: "在坡州享受的<br>特别一天",
          exp_desc: "超越单纯购买，通过体验完成的本地旅行。<br>这个周末，请和心爱的人一起去坡州吧。",
          farmer_tag: "MONTHLY FARMER",
          farmer_title: "“丑陋的水果？<br>因为无农药生长”",
          farmer_desc: "在坡州汶山邑从事40年苹果种植的 <b style='color: #333;'>金哲秀农夫</b>。<br>他说挺过今年格外严重的风雨的苹果们很了不起。虽然形状有点粗糙，但连皮咬下时充满口腔的浓郁风味是百货店水果无法比拟的。",
          farmer_btn_interview: "查看采访全文",
          farmer_btn_buy: "购买丑陋苹果",
          export_tag: "K-WELLNESS GLOBAL PROJECT",
          export_title: "坡州的味道，走向世界",
          export_desc: "从利用长湍豆制作的<strong>豆腐饼干</strong>到人参果冻。<br>加工坡州的特产，抓住世界人的口味。",
          export_btn: "参观全球馆",
          export_p1: "长湍豆豆腐饼干",
          export_p1_desc: "出口美国/日本",
          export_p2: "开城人参果冻条",
          export_p2_desc: "出口东南亚3国",
          export_p3: "山葡萄起泡酒",
          export_p3_desc: "预计出口欧洲",
          export_p4: "汉水泡菜",
          export_p4_desc: "获得纯素认证",
          season_tag: "SEASONAL PICK",
          season_title: "现在最美味的",
          season_more_btn: "查看全部商品",
          review_title: "#LocaleatPaju 后记",
          review_desc: "请分享到达餐桌的坡州的新鲜感。",
          footer_desc: "LocaleatPaju是坡州市青年农夫们共同打造的<br>本地食品共生项目。",
          footer_link_story: "品牌故事",
          footer_link_terms: "使用条款",
          footer_link_privacy: "个人信息处理方针",
          footer_link_inquiry: "入驻/合作咨询",
          footer_info: "京畿道坡州市和平路123 (汶山邑) 1层 | 代表: 金坡州<br>营业执照号: 000-00-00000 | 通信销售业申报: 2024-坡州-0000<br>COPYRIGHT © 2024 LOCALeatPAJU. ALL RIGHTS RESERVED.",
          ai_title: "智能本地生活",
          ai_desc: "苦恼吃什么，送谁礼物吗？<br>AI将为您提供符合您的口味和情况的建议。",
          ai_tab_chef: "购物车大厨",
          ai_tab_gift: "礼物策划师",
          ai_chef_guide: "请选择购物车中的材料（或冰箱里的）材料。",
          ing_bean: "长湍豆",
          ing_rice: "汉水大米",
          ing_ginseng: "开城人参",
          ing_yam: "长湍山药",
          ing_wine: "山葡萄红酒",
          ing_honey: "DMZ 蜂蜜",
          btn_recipe: "接收食谱推荐",
          gift_target_default: "送给谁礼物？",
          target_parents: "父母 / 长辈",
          target_friend: "朋友 / 同事",
          target_couple: "恋人 / 配偶",
          target_kids: "孩子 / 侄子/侄女",
          gift_occasion_default: "是什么情况？",
          occasion_health: "健康关怀",
          occasion_party: "家庭派对",
          occasion_snack: "轻食",
          occasion_holiday: "节日 / 纪念日",
          btn_find_gift: "寻找定制礼物",
          ai_analyzing: "AI正在分析最佳组合...",
          time_sale_badge: "限时特卖",
          ugly_market_title: "即将截止！丑陋市场",
          ugly_market_desc: "味道和营养依旧，价格破格！请参与价值消费。",
          ugly_item_name: "坡州丑陋苹果 5kg",
          time_left: "剩余时间:",
          btn_ugly_buy: "立即解救",
          group_buy_badge: "共同购买",
          group_buy_title: "每月收获！共同购买",
          group_buy_desc: "聚在一起更便宜。达成目标时直接从产地出发到家。",
          group_item_name: "高冷地白菜 100棵套装",
          group_status: "当前85人参与",
          group_target: "达成100人时截止",
          btn_group_join: "参与团购",
          sub_tag: "MONTHLY PAJU",
          sub_title: "时令策展订阅<br>'月刊坡州'",
          sub_desc: "不要苦恼。每月将最美味的坡州时令食材和<br>大厨的食谱卡送到您家。",
          btn_sub_start: "开始订阅",
          btn_sub_details: "查看本月构成",
          sub_box_title: "4月的坡州盒",
          sub_item_1: "春季野菜3种套装",
          sub_item_2: "环保草莓 500g",
          sub_item_3: "AI 大厨食谱卡"
     }
};

let currentLang = 'ko';

function changeLanguage(lang) {
     currentLang = lang;
     localStorage.setItem('preferredLang', lang); // Save preference
     const t = translations[lang];

     // Apply translations to DOM elements with data-i18n attributes
     document.querySelectorAll('[data-i18n]').forEach(el => {
          const key = el.getAttribute('data-i18n');
          if (t[key]) {
               el.innerHTML = t[key];
          }
     });

     // Update dropdown label and active state
     const labels = { ko: 'KOREAN', en: 'ENGLISH', jp: 'JAPANESE', cn: 'CHINESE' };
     const labelEl = document.getElementById('current-lang-label');
     if (labelEl) labelEl.innerText = labels[lang];

     // Update active class in dropdown
     document.querySelectorAll('.lang-item').forEach(btn => {
          btn.classList.remove('active');
          if (btn.getAttribute('onclick') && btn.getAttribute('onclick').includes(lang)) {
               btn.classList.add('active');
          }
     });

     // Re-render dynamic content
     renderApp();
}

// -----------------------------------------------------------
// 1. API & Data Logic (Consolidated for local preview)
// -----------------------------------------------------------

async function getProducts() {
     try {
          const response = await fetch('./data/products.json');
          if (!response.ok) throw new Error('Failed to fetch products');
          return await response.json();
     } catch (error) {
          console.warn('Local preview mode: Using fallback data for products');
          return [
               // --- A. Big Shots (파주 3대장) ---
               {
                    "id": "p1",
                    "name": "파주 장단콩 (백태) 1kg",
                    "price": 18000,
                    "category": "프리미엄 콩",
                    "image": "assets/products/jangdan_soybean.png",
                    "badges": ["베스트셀러", "임금님 진상"],
                    "description": "임금님 수라상에 올랐던 파주의 자랑. 배수가 잘 되는 마사토에서 자라 고소한 맛과 영양이 일품입니다.",
                    "trans": {
                         "en": { "name": "Paju Jangdan Soybeans 1kg", "description": "The pride of Paju, once served to the King. Grown in well-drained soil for a rich, nutty flavor." },
                         "jp": { "name": "坡州長湍豆 (白大豆) 1kg", "description": "王様の食卓に上がった坡州の誇り。水はけの良い土壌で育ち、香ばしい味と栄養が逸品です。" },
                         "cn": { "name": "坡州长湍豆 (白豆) 1kg", "description": "曾进贡给国王的坡州骄傲。在排水良好的磨沙土中生长，香味和营养一绝。" }
                    }
               },
               {
                    "id": "p5",
                    "name": "파주 개성인삼 6년근",
                    "price": 65000,
                    "category": "프리미엄 인삼",
                    "image": "assets/products/paju_ginseng.png",
                    "badges": ["면역력강화"],
                    "description": "고려인삼의 맥을 잇는 6년근 파주 인삼. DMZ의 청정 자연이 키워내 사포닌 함량이 월등히 높습니다.",
                    "trans": {
                         "en": { "name": "Paju Gaeseong Ginseng (6-year)", "description": "6-year-old Ginseng inheriting the legacy of Goryeo Ginseng. Grown in DMZ's nature." },
                         "jp": { "name": "坡州開城高麗人参 6年根", "description": "高麗人参の脈を受け継ぐ6年根坡州人参。DMZの清浄な自然が育て、サポニン含有量が非常に高いです。" },
                         "cn": { "name": "坡州开城人参 6年根", "description": "继承高丽人参脉络的6年根坡州人参。DMZ洁净自然培育，皂苷含量极高。" }
                    }
               },
               {
                    "id": "p6",
                    "name": "임진강 한수위 쌀 10kg",
                    "price": 42000,
                    "category": "프리미엄 쌀",
                    "image": "assets/products/hansuwi_rice.png",
                    "badges": ["무농약인증"],
                    "description": "기름진 토양과 깨끗한 물이 키워낸 밥맛의 본질.",
                    "trans": {
                         "en": { "name": "Imjingang Hansuwi Rice 10kg", "description": "Premium rice grown with clear water from Imjin River. The rice itself tastes sweet." },
                         "jp": { "name": "臨津江ハンスウィ米 10kg", "description": "臨津江の清らかな水と肥沃な土地が育てた名品米。一粒一粒が生きており、噛むほどに甘みが広がります。" },
                         "cn": { "name": "临津江汉水大米 10kg", "description": "临津江清澈的河水和肥沃土地培育的名品大米。米粒饱满，越嚼越甜。" }
                    }
               },

               // --- B. Hidden Gems (숨은 보석) ---
               {
                    "id": "p7",
                    "name": "감악산 야생 칡즙 (30포)",
                    "price": 35000,
                    "category": "자연산",
                    "image": "assets/products/gamaksan_herbs.png",
                    "badges": ["숙취해소", "이너뷰티"],
                    "description": "사람의 손이 닿지 않은 야생, 그 강인한 생명력을 담다.",
                    "trans": {
                         "en": { "name": "Gamaksan Wild Arrowroot Extract", "description": "Wild vitality from Gamaksan untouched by human hands. A forest gift for inner beauty." },
                         "jp": { "name": "紺岳山野生葛汁 (30包)", "description": "人の手が届かない紺岳山の深い場所にある野生葛。土の中の真珠と呼ばれる葛の濃い生命力を込めました。" },
                         "cn": { "name": "绀岳山野生葛根汁 (30包)", "description": "人迹罕至的绀岳山深处的野生葛。蕴含被称为土中珍珠的葛根的浓郁生命力。" }
                    }
               },
               {
                    "id": "p8",
                    "name": "파주 장단 마 (둥근마) 5kg",
                    "price": 48000,
                    "category": "뿌리 채소",
                    "image": "assets/products/jangdan_yam.png",
                    "badges": ["위장보호"],
                    "description": "임진강 사질토에서 자라 육질이 단단하고 맛이 담백합니다. 바쁜 아침, 속을 편안하게 해주는 최고의 식사입니다.",
                    "trans": {
                         "en": { "name": "Paju Jangdan Yam (Round) 5kg", "description": "Yam grown in Imjin River's sandy soil. A morning friend that protects your stomach." },
                         "jp": { "name": "坡州長湍長芋 (丸芋) 5kg", "description": "臨津江の砂質土で育ち、肉質がしっかりして味が淡泊です。忙しい朝、胃を楽にしてくれる最高の食事です。" },
                         "cn": { "name": "坡州长湍山药 (圆山药) 5kg", "description": "在临津江沙质土中生长，肉质结实，味道清淡。繁忙的早晨，让肠胃舒适的最佳餐点。" }
                    }
               },
               {
                    "id": "p3",
                    "name": "파주 산머루 와인 Premium",
                    "price": 32000,
                    "category": "로컬 와인",
                    "image": "assets/products/sanmeoru_wine.png",
                    "badges": ["선물용추천"],
                    "description": "파주의 높은 일교차가 만들어낸 당도 높은 산머루. 감악산 터널에서 숙성하여 깊고 그윽한 풍미를 자랑합니다.",
                    "trans": {
                         "en": { "name": "Paju Wild Grape Wine Premium", "description": "Sweet wild grape wine aged in Gamaksan tunnels. Boasts a deep flavor." },
                         "jp": { "name": "山葡萄ワイナリーツアー", "description": "坡州の大きな日較差が作り出した高糖度の山葡萄。紺岳山トンネルで熟成し、深く幽玄な風味を誇ります。" },
                         "cn": { "name": "坡州山葡萄红酒 Premium", "description": "坡州巨大的昼夜温差造就的高糖度山葡萄。在绀岳山隧道熟成，散发深邃幽雅的风味。" }
                    }
               },

               // --- C. Trendy Curations (청년/가공식품) ---
               {
                    "id": "c1",
                    "name": "장단콩 비건 크림 롤케이크",
                    "price": 18500,
                    "category": "비건 디저트",
                    "image": "assets/products/tofu_snack.png",
                    "badges": ["비건인증", "글루텐프리"],
                    "description": "[글루텐 프리] 우유 버터 없이도 충분히 부드러운. 장단콩의 고소함을 가득 채운 비건 디저트.",
                    "trans": {
                         "en": { "name": "Jangdan Bean Vegan Cream Roll", "description": "Gluten-free dessert filled with nutty bean cream instead of milk. Comfortable sweetness." },
                         "jp": { "name": "長湍豆ヴィーガンクリームロール", "description": "【グルテンフリー】牛乳・バターなしでも十分に柔らかい。長湍豆の香ばしさを満たしたヴィーガンデザート。" },
                         "cn": { "name": "长湍豆纯素奶油卷蛋糕", "description": "[无麸质]即使没有牛奶黄油也足够柔软。充满长湍豆香气的纯素甜点。" }
                    }
               },
               {
                    "id": "c2",
                    "name": "DMZ 모닝 쉐이크 (마+콩)",
                    "price": 29000,
                    "category": "모닝 루틴",
                    "image": "assets/products/jangdan_yam.png",
                    "badges": ["DAILY"],
                    "description": "바쁜 아침, 위장을 보호하는 DMZ 한 잔. 장단콩의 고소함이 마의 식감을 부드럽게 감싸줍니다.",
                    "trans": {
                         "en": { "name": "DMZ Morning Shake (Yam+Bean)", "description": "A sip of DMZ for your busy morning stomach. Nutty beans soften the texture of yam." },
                         "jp": { "name": "DMZモーニングシェイク (長芋+豆)", "description": "忙しい朝、胃腸を保護するDMZ一杯。長湍豆の香ばしさが長芋の食感を優しく包み込みます。" },
                         "cn": { "name": "DMZ 早晨奶昔 (山药+豆)", "description": "繁忙的早晨，保护肠胃的DMZ一杯。长湍豆的香气柔和地包裹住山药的口感。" }
                    }
               },
               {
                    "id": "c5",
                    "name": "달콤 파주 사과 약과 (Apple Soy)",
                    "price": 12000,
                    "category": "인기 간식",
                    "image": "assets/products/tofu_snack.png",
                    "badges": ["K-디저트"],
                    "description": "파주 사과 조청의 달콤함과 장단콩의 고소함이 만난 퓨전 약과. 할매니얼 입맛 저격!",
                    "trans": {
                         "en": { "name": "Apple Soy Yakgwa", "description": "Fusion Yakgwa meeting sweet Paju apple syrup and nutty beans. Perfect for K-dessert lovers!" },
                         "jp": { "name": "甘い坡州リンゴ薬果 (Apple Soy)", "description": "坡州リンゴ水飴の甘さと長湍豆の香ばしさが出会ったフュージョン薬果。ハルメニアルの好みを狙撃！" },
                         "cn": { "name": "香甜坡州苹果药果 (Apple Soy)", "description": "坡州苹果糖浆的甜味与长湍豆的香气相遇的融合药果。狙击复古口味！" }
                    }
               },

               // --- Experiences ---
               {
                    "id": "e1",
                    "name": "감자 캐기 & 팜크닉 (1인)",
                    "price": 25000,
                    "category": "이색 체험",
                    "image": "assets/images/global_farm.png",
                    "badges": ["아이체험강추"],
                    "description": "파주의 흙을 만지며 수확의 기쁨을 느껴보세요. 유기농 채소 비빔밥 점심이 포함되어 있습니다.",
                    "trans": {
                         "en": { "name": "Potato Digging & Farmnic (1 Person)", "description": "Touch the soil of Paju and feel the joy of harvest. Organic vegetable lunch included." },
                         "jp": { "name": "ジャガイモ掘り & ファームニック (1人)", "description": "坡州の土に触れて収穫の喜びを感じてください。有機野菜ビビンバのランチが含まれています。" },
                         "cn": { "name": "挖土豆 & 农场野餐 (1人)", "description": "触摸坡州的泥土，感受收获的喜悦。包含有机蔬菜拌饭午餐。" }
                    }
               },
               {
                    "id": "e2",
                    "name": "별밤 글램핑 (1박)",
                    "price": 150000,
                    "category": "캠핑",
                    "image": "assets/images/korean_camping.png",
                    "badges": ["커플추천"],
                    "description": "쏟아지는 별빛 아래, 장작불과 함께하는 낭만적인 밤을 선물합니다.",
                    "trans": {
                         "en": { "name": "Starlight Glamping (1 Night)", "description": "A romantic night with a campfire under the pouring starlight." },
                         "jp": { "name": "星月夜グランピング (1泊)", "description": "降り注ぐ星空の下、焚き火と共に過ごすロマンチックな夜をプレゼントします。" },
                         "cn": { "name": "星夜豪华露营 (1晚)", "description": "在倾泻的星光下，献上与柴火共度的浪漫之夜。" }
                    }
               },
               {
                    "id": "e4",
                    "name": "산머루 와이너리 투어",
                    "price": 20000,
                    "category": "와이너리 투어",
                    "image": "assets/products/sanmeoru_wine.png",
                    "badges": ["이색데이트"],
                    "description": "신비한 지하 와인 터널 투어와 나만의 와인 만들기 체험. 연인들의 데이트 코스로 강력 추천합니다.",
                    "trans": {
                         "en": { "name": "Sanmeoru Winery Tour", "description": "Mysterious underground wine tunnel tour and making your own wine. Recommended for couples." },
                         "jp": { "name": "山葡萄ワイナリーツアー", "description": "神秘的な地下ワイントンネルツアーと自分だけのワイン作り体験。恋人たちのデートコースとして強くお勧めします。" },
                         "cn": { "name": "山葡萄以酒庄巡游", "description": "神秘的地下红酒隧道游览和制作专属红酒体验。强烈推荐作为情侣约会路线。" }
                    }
               },
               {
                    "id": "cp1",
                    "name": "시크릿가든 캠핑장",
                    "price": 60000,
                    "category": "캠핑",
                    "image": "https://images.unsplash.com/photo-1510312305653-8ed496efae75?auto=format&fit=crop&w=800&q=80",
                    "badges": ["프라이빗", "수영장"],
                    "description": "감악산 자락에 위치한 프라이빗 캠핑장. 개별 바베큐장과 수영장, 감성 카페를 갖춘 럭셔리 휴양지.",
                    "trans": {
                         "en": { "name": "The Secret Garden Camping", "description": "Emotional atmosphere camping. Best for couples with private BBQ, pool, and cafe." },
                         "jp": { "name": "シークレットガーデンキャンプ場", "description": "紺岳山の麓に位置するプライベートキャンプ場。個別のバーベキュー場とプール、感性カフェを備えたラグジュアリーリゾート。" },
                         "cn": { "name": "秘密花园露营地", "description": "位于绀岳山脚下的私人露营地。配备独立烧烤场、游泳池和感性咖啡厅的豪华度假地。" }
                    }
               },
               {
                    "id": "cp2",
                    "name": "벽초지수목원 캠핑장",
                    "price": 50000,
                    "category": "캠핑",
                    "image": "https://images.unsplash.com/photo-1478131143081-80f7f84ca84d?auto=format&fit=crop&w=800&q=80",
                    "badges": ["식물원뷰", "반려동물"],
                    "description": "수목원 내에 위치해 완벽한 숲캉스를 즐길 수 있습니다. 반려동물 동반이 가능해 온 가족이 행복한 시간을 보낼 수 있습니다.",
                    "trans": {
                         "en": { "name": "Byeokchoji Arboretum Camping", "description": "Located inside the arboretum for nature lovers. Pet-friendly for the whole family." },
                         "jp": { "name": "碧草池樹木園キャンプ場", "description": "樹木園内に位置し、完璧な森休みを楽しめます。ペット同伴が可能で、全家族が幸せな時間を過ごせます。" },
                         "cn": { "name": "碧草池树木园露营地", "description": "位于树木园内，可享受完美的森林度假。允许携带宠物，全家人可以共度幸福时光。" }
                    }
               },
               {
                    "id": "cp3",
                    "name": "감악산 캠핑장",
                    "price": 40000,
                    "category": "캠핑",
                    "image": "https://images.unsplash.com/photo-1504280390367-361c6d9f38f4?auto=format&fit=crop&w=800&q=80",
                    "badges": ["계곡물놀이", "샤워장"],
                    "description": "계곡 바로 옆에 있어 여름철 물놀이에 최적화된 곳. 깨끗한 샤워시설과 바베큐장이 준비되어 있습니다.",
                    "trans": {
                         "en": { "name": "Gamaksan Camping", "description": "Located right next to the valley, perfect for summer swimming. Free showers and BBQ." },
                         "jp": { "name": "紺岳山キャンプ場", "description": "渓谷のすぐ横にあり、夏の水遊びに最適化された場所。清潔なシャワー施設とバーベキュー場が用意されています。" },
                         "cn": { "name": "绀岳山露营地", "description": "紧邻溪谷，非常适合夏季玩水。准备了干净的淋浴设施和烧烤场。" }
                    }
               },
               {
                    "id": "cp4",
                    "name": "평화누리 캠핑장",
                    "price": 30000,
                    "category": "캠핑",
                    "image": "https://images.unsplash.com/photo-1537905569824-f89f14cceb68?auto=format&fit=crop&w=800&q=80",
                    "badges": ["넓은공간", "조용한"],
                    "description": "평화 누리 공원의 넓은 잔디밭에서 즐기는 여유로운 캠핑. 탁 트인 시야와 조용한 휴식을 원하는 캠퍼들에게 추천.",
                    "trans": {
                         "en": { "name": "Imjingak Peace Camping", "description": "Spacious sites and a quiet atmosphere. Recommended for campers seeking peaceful rest." },
                         "jp": { "name": "平和ヌリキャンプ場", "description": "平和ヌリ公園の広い芝生で楽しむゆったりとしたキャンプ。広々とした視界と静かな休息を望むキャンパーにおすすめ。" },
                         "cn": { "name": "和平Nuri露营地", "description": "在和平Nuri公园广阔的草坪上享受悠闲的露营。推荐给想要开阔视野和安静休息的露营者。" }
                    }
               },
               {
                    "id": "cp5",
                    "name": "DMZ 캠핑장",
                    "price": 35000,
                    "category": "캠핑",
                    "image": "assets/images/dmz_camping_gen.png",
                    "badges": ["안보관광", "텐트대여"],
                    "description": "DMZ 접경 지역에서 즐기는 이색적인 캠핑. 안보 관광과 함께 특별한 추억을 만들 수 있습니다.",
                    "trans": {
                         "en": { "name": "DMZ Camping", "description": "Special camping near the DMZ. Combine security tourism with traditional tent experience." },
                         "jp": { "name": "DMZキャンプ場", "description": "DMZ接境地域で楽しむ異色キャンプ。安保観光と共に特別な思い出を作ることができます。" },
                         "cn": { "name": "DMZ露营地", "description": "在DMZ边境地区享受的特色露营。可以结合安保旅游创造特别的回忆。" }
                    }
               },
               {
                    "id": "cp6",
                    "name": "파주 글램핑 빌리지",
                    "price": 80000,
                    "category": "글램핑",
                    "image": "https://images.unsplash.com/photo-1523987355523-c7b5b0dd90a7?auto=format&fit=crop&w=800&q=80",
                    "badges": ["호텔식", "개별화장실"],
                    "description": "호텔식 침구와 개별 화장실을 갖춘 럭셔리 글램핑. 텐트가 없어도, 캠핑 장비가 없어도 누구나 즐길 수 있습니다.",
                    "trans": {
                         "en": { "name": "Paju Glamping Village", "description": "Luxury glamping facilities with private restrooms. Enjoy like a hotel even if you're a beginner." },
                         "jp": { "name": "坡州グランピングビレッジ", "description": "ホテル式寝具と個別トイレを備えたラグジュアリーグランピング。テントがなくても、キャンプ装備がなくても誰でも楽しめます。" },
                         "cn": { "name": "坡州豪华露营村", "description": "配备酒店式寝具和独立卫生间的豪华露营。即使没有帐篷，没有露营装备，任何人都可以享受。" }
                    }
               },
               {
                    "id": "cp7",
                    "name": "오토 캠핑 숲",
                    "price": 50000,
                    "category": "오토캠핑",
                    "image": "assets/images/korean_car_camping.png",
                    "badges": ["차박가능", "수영장"],
                    "description": "넓은 오토 캠핑 사이트와 수영장을 갖춘 숲속 캠핑장. 차박을 즐기는 분들에게 최적화된 공간입니다.",
                    "trans": {
                         "en": { "name": "Auto Camping Forest", "description": "Equipped with large auto camping zones and a pool. Recommended for car camping and swimming." },
                         "jp": { "name": "オートキャンプの森", "description": "広いオートキャンプサイトとプールを備えた森の中のキャンプ場。車中泊を楽しむ方々に最適化された空間です。" },
                         "cn": { "name": "汽车露营森林", "description": "拥有宽敞的汽车露营营位和游泳池的森林露营地。是享受车中泊的人们的最佳空间。" }
                    }
               }
          ];
     }
}

async function getMarketPrices() {
     // No delay for instant feedback
     return {
          date: new Date().toLocaleDateString('ko-KR'),
          items: [
               {
                    name: '딸기 (2kg)', marketPrice: 32000, localPrice: 25000, trend: 'up',
                    trans: {
                         en: "Strawberry (2kg)", jp: "イチゴ (2kg)", cn: "草莓 (2kg)"
                    }
               },
               {
                    name: '상추 (100g)', marketPrice: 1500, localPrice: 1200, trend: 'stable',
                    trans: {
                         en: "Lettuce (100g)", jp: "サンチュ (100g)", cn: "生菜 (100g)"
                    }
               },
               {
                    name: '방울토마토 (1kg)', marketPrice: 18000, localPrice: 15000, trend: 'down',
                    trans: {
                         en: "Cherry Tomato (1kg)", jp: "ミニトマト (1kg)", cn: "圣女果 (1kg)"
                    }
               },
               {
                    name: '꿀고구마 (1kg)', marketPrice: 6500, localPrice: 5000, trend: 'up',
                    trans: {
                         en: "Sweet Potato (1kg)", jp: "蜜サツマイモ (1kg)", cn: "蜜红薯 (1kg)"
                    }
               }
          ]
     };
}

function formatPrice(price) {
     return new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW' }).format(price);
}

// -----------------------------------------------------------
// 2. Components
// -----------------------------------------------------------

function initHeader() {
     const header = document.getElementById('main-header');
     if (header) {
          // window.addEventListener('scroll', () => {
          //      if (window.scrollY > 50) {
          //           header.classList.add('scrolled');
          //      } else {
          //           header.classList.remove('scrolled');
          //      }
          // });
     }
}

const badgeTranslations = {
     "베스트셀러": { en: "Best Seller", jp: "ベストセラー", cn: "畅销" },
     "임금님 진상": { en: "King's Choice", jp: "王様への献上", cn: "进贡贡品" },
     "면역력강화": { en: "Immunity Boost", jp: "免疫力強化", cn: "增强免疫力" },
     "무농약인증": { en: "Pesticide Free", jp: "無農薬認証", cn: "无农药认证" },
     "숙취해소": { en: "Hangover Cure", jp: "二日酔い解消", cn: "解酒" },
     "이너뷰티": { en: "Inner Beauty", jp: "インナービューティー", cn: "内在美" },
     "위장보호": { en: "Stomach Care", jp: "胃腸保護", cn: "保护胃肠" },
     "선물용추천": { en: "Best Gift", jp: "ギフト推奨", cn: "推荐礼品" },
     "비건인증": { en: "Vegan", jp: "ヴィーガン", cn: "纯素认证" },
     "글루텐프리": { en: "Gluten Free", jp: "グルテンフリー", cn: "无麸质" },
     "DAILY": { en: "Daily", jp: "デイリー", cn: "日常" },
     "K-디저트": { en: "K-Dessert", jp: "K-デザート", cn: "K-甜点" },
     "아이체험강추": { en: "Kids Favorite", jp: "子供体験推奨", cn: "强推儿童体验" },
     "커플추천": { en: "For Couples", jp: "カップル推奨", cn: "推荐情侣" },
     "이색데이트": { en: "Unique Date", jp: "異色デート", cn: "特色约会" },
     "프라이빗": { en: "Private", jp: "プライベート", cn: "私密" },
     "수영장": { en: "Pool", jp: "プール", cn: "游泳池" },
     "식물원뷰": { en: "Garden View", jp: "植物園ビュー", cn: "植物园景观" },
     "반려동물": { en: "Pet Friendly", jp: "ペット同伴可", cn: "允许宠物" },
     "계곡물놀이": { en: "Valley Water", jp: "渓谷水遊び", cn: "溪谷玩水" },
     "샤워장": { en: "Shower", jp: "シャワー", cn: "淋浴场" },
     "넓은공간": { en: "Spacious", jp: "広い空間", cn: "宽敞空间" },
     "조용한": { en: "Quiet", jp: "静かな", cn: "安静" },
     "안보관광": { en: "Security Tour", jp: "安保観光", cn: "安保旅游" },
     "텐트대여": { en: "Tent Rental", jp: "テントレンタル", cn: "帐篷租赁" },
     "호텔식": { en: "Hotel Style", jp: "ホテル式", cn: "酒店式" },
     "개별화장실": { en: "Private Toilet", jp: "個別トイレ", cn: "独立卫生间" },
     "차박가능": { en: "Car Camping", jp: "車中泊可能", cn: "可车中泊" }
};

function renderProductCard(product) {
     const t = (product.trans && product.trans[currentLang]) || {};
     const name = t.name || product.name;
     const desc = t.description || product.description;

     const badgeHtml = product.badges && product.badges.length > 0
          ? `<div class="badge" style="position: absolute; top: 12px; left: 12px; background: #C19A6B; color: white; padding: 4px 8px; font-size: 0.7rem; font-weight: 700; border-radius: 4px; z-index: 2; letter-spacing: 0.05em;">${(badgeTranslations[product.badges[0]] && badgeTranslations[product.badges[0]][currentLang]) || product.badges[0]}</div>`
          : '';

     return `
     <div class="product-card fade-in">
          <a href="#">
               <div class="product-img-wrap" style="border-radius: 8px;">
                    ${badgeHtml}
                    <img src="${product.image}" alt="${name}" class="product-img">
               </div>
               <div class="product-info" style="padding-top: 12px;">
                    <span class="product-category" style="color: #C19A6B; font-size: 0.7rem; font-weight: 700; letter-spacing: 0.05em; text-transform: uppercase; margin-bottom: 6px; display:block;">${product.category}</span>
                    <h3 style="font-size: 1rem; font-weight: 700; margin-bottom: 8px; line-height: 1.4; height: 2.8em; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">${name}</h3>
                    <p style="font-size: 0.85rem; color: #888; margin-bottom: 12px; line-height: 1.5; height: 3em; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">${desc ? desc : ''}</p>
                    <div class="flex items-center">
                         <p style="color: #111; font-weight: 800; font-size: 1.1rem; font-family:var(--font-main);">` + formatPrice(product.price) + `</p>
                    </div>
               </div>
          </a>
     </div>
     `;
}

function renderPriceWidget(data) {
     const trendLabels = {
          ko: { up: '급등', down: '하락', stable: '안정', cheap: '저렴', avg: '평균' },
          en: { up: 'Rising', down: 'Falling', stable: 'Stable', cheap: 'Cheaper', avg: 'Avg' },
          jp: { up: '急騰', down: '下落', stable: '安定', cheap: '安値', avg: '平均' },
          cn: { up: '暴涨', down: '下跌', stable: '稳定', cheap: '便宜', avg: '平均' }
     };
     const label = trendLabels[currentLang] || trendLabels.ko;

     const itemsHtml = data.items.map(item => {
          const tName = (item.trans && item.trans[currentLang]) || item.name;
          const saving = item.marketPrice - item.localPrice;
          const trendIcon = item.trend === 'up' ? 'text-red-500 fa-arrow-up' :
               item.trend === 'down' ? 'text-blue-500 fa-arrow-down' : 'text-gray-400 fa-minus';
          const iconColor = item.trend === 'up' ? '#ef4444' : item.trend === 'down' ? '#3b82f6' : '#9ca3af';
          const trendText = item.trend === 'up' ? label.up : item.trend === 'down' ? label.down : label.stable;

          return `
     <div class="price-item" style="border-bottom: 1px solid #eee; padding: 16px 0;">
            <div class="flex justify-between items-center mb-1">
                <span style="font-weight: 600; font-size: 1.05rem;">${tName}</span>
                <span style="font-size: 0.85rem; color: #888;">
                    <span style="color: var(--color-primary); font-weight: 700;">${Math.round((saving / item.marketPrice) * 100)}% ${label.cheap}</span>
                </span>
            </div>
            <div class="flex justify-between items-center">
                <div style="font-size: 0.9rem; color: #666;">
                    ${label.avg} <span style="text-decoration: line-through;">${formatPrice(item.marketPrice)}</span>
                </div>
                <div class="flex items-center gap-sm">
                    <span style="font-weight: 700; color: var(--color-text-main); font-size: 1.1rem;">
                        ${formatPrice(item.localPrice)}
                    </span>
                </div>
            </div>
            <div style="margin-top: 8px; font-size: 0.8rem; color: #999; display: flex; align-items: center; gap: 4px;">
                <i class="fas fa-chart-line" style="font-size: 0.7rem; color: ${iconColor}"></i> 
                <span>${trendText}</span>
            </div>
        </div>
     `;
     }).join('');

     // Use global translations object for widget header
     const t = translations[currentLang];
     const priceTitle = t.p_stat_price_title ? t.p_stat_price_title.replace('<br>', ' ') : '오늘의 가격, 투명하게';
     const priceDesc = t.p_stat_desc ? t.p_stat_desc.split('<br>')[0] : '농산물유통정보(KAMIS) 데이터 기반 실시간 시세 비교';

     return `
     <div class="price-widget-card" style="background: white; border-radius: 16px; padding: 32px; box-shadow: 0 10px 30px rgba(0,0,0,0.08);">
        <div style="margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid var(--color-text-main);">
            <div class="flex justify-between items-end">
                <h3 style="font-family: var(--font-serif); font-size: 1.5rem; margin: 0;">${priceTitle}</h3>
                <span style="font-size: 0.85rem; color: #666;">${data.date} (aT)</span>
            </div>
            <p style="font-size: 0.9rem; color: var(--color-text-sub); margin-top: 8px;">
                ${priceDesc}
            </p>
        </div>
        <div class="price-list">
            ${itemsHtml}
        </div>
        <div style="margin-top: 24px; text-align: center;">
            <a href="#" style="font-size: 0.85rem; color: var(--color-text-light); text-decoration: underline;">
                Data Source: KAMIS
            </a>
        </div>
    </div>
     `;
}

// -----------------------------------------------------------
// 3. Main Execution
// -----------------------------------------------------------

let globalProducts = [];
let globalMarketData = null;

async function fetchData() {
     try {
          const [products, marketData] = await Promise.all([
               getProducts(),
               getMarketPrices()
          ]);
          globalProducts = products;
          globalMarketData = marketData;
          renderApp();
     } catch (e) {
          console.error("Fetch error", e);
     }
}

function renderApp() {
     const productGrid = document.getElementById('product-grid');
     const expGrid = document.getElementById('experience-grid');
     const priceWidgetContainer = document.getElementById('price-widget-container');

     // Filter Products & Experiences
     const marketProducts = globalProducts.filter(p => !p.category.includes('이색 체험') && !p.category.includes('농장') && !p.category.includes('캠핑') && !p.category.includes('투어') && !p.category.includes('글램핑') && !p.category.includes('오토캠핑'));
     const experienceProducts = globalProducts.filter(p => p.category.includes('이색 체험') || p.category.includes('농장') || p.category.includes('캠핑') || p.category.includes('투어') || p.category.includes('글램핑') || p.category.includes('오토캠핑'));

     // Render Market Products
     if (productGrid && marketProducts.length > 0) {
          productGrid.innerHTML = marketProducts.map(product => renderProductCard(product)).join('');
     }

     // Render Experience Section
     if (expGrid && experienceProducts.length > 0) {
          expGrid.innerHTML = experienceProducts.map(item => renderExperienceCard(item)).join('');
     }

     // Render Price Widget
     if (priceWidgetContainer && globalMarketData) {
          priceWidgetContainer.innerHTML = renderPriceWidget(globalMarketData);
     }

     // Start Special Offer Timers & Bars (New)
     updateTimer();
     updateProgressBar();
}

// Special Offer Logic
function updateTimer() {
     const timerEl = document.getElementById('ugly-timer');
     if (!timerEl) return;

     // Set a fixed end time for demo purposes (e.g., 4 hours from now) or a looping timer
     let timeLeft = 3 * 3600 + 45 * 60 + 12; // 3h 45m 12s initial

     // If we want it to actually tick
     setInterval(() => {
          timeLeft--;
          if (timeLeft < 0) timeLeft = 4 * 3600; // Reset

          const h = Math.floor(timeLeft / 3600);
          const m = Math.floor((timeLeft % 3600) / 60);
          const s = timeLeft % 60;

          timerEl.innerText = `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
     }, 1000);
}

function updateProgressBar() {
     // Simple animation for the progress bar
     const bar = document.querySelector('.progress-fill'); // Need to ensure class matches HTML
     // HTML used inline styles, but let's assume valid selection or add a simpler approach if class missing
     // Actually, let's just leave static for now or add a class in HTML. 
     // The HTML I added earlier didn't have a specific class for the bar div, it had inline style width: 85%.
     // Let's assume static is fine for the progress bar as it is "85% Joined".
}

function renderExperienceCard(item) {
     const t = (item.trans && item.trans[currentLang]) || {};
     const name = t.name || item.name;
     const desc = t.description || item.description;

     // Badges
     let badgeHtml = '';
     if (item.badges && item.badges.length > 0) {
          badgeHtml = item.badges.map(b =>
               `<span style="background: white; color: var(--color-primary); padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-right: 6px;">${(badgeTranslations[b] && badgeTranslations[b][currentLang]) || b}</span>`
          ).join('');
     }

     return `
      <div class="experience-card fade-in" style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.08); transition: transform 0.3s ease;">
           <div class="img-box" style="height: 220px; position: relative;">
                <img src="${item.image}" alt="${name}" style="width: 100%; height: 100%; object-fit: cover;">
                <div style="position: absolute; top: 15px; left: 15px; display: flex;">
                     ${badgeHtml}
                </div>
           </div>
           <div class="content-box" style="padding: 20px;">
                <span style="color: var(--color-accent); font-weight: 700; letter-spacing: 0.05em; font-size: 0.75rem; margin-bottom: 6px; display: block;">${item.category}</span>
                <h3 style="font-size: 1.15rem; margin-bottom: 10px; font-family: var(--font-serif); line-height: 1.3;">${name}</h3>
                <p style="color: #666; margin-bottom: 16px; line-height: 1.5; font-size: 0.9rem; height: 3em; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">${desc}</p>
                <div class="flex justify-between items-center" style="border-top: 1px solid #eee; padding-top: 15px;">
                     <span style="font-size: 1.1rem; font-weight: 700; color: #111;">${formatPrice(item.price)} <span style="font-size: 0.8rem; font-weight: 400; color: #888;">/ 1인</span></span>
                     <a href="#" class="btn btn-outline" style="padding: 6px 15px; font-size: 0.8rem;">예약하기</a>
                </div>
           </div>
      </div>
      `;
}

// --- AI Feature Logic ---
let selectedIngredients = new Set();

window.switchAiTab = function (tabName) {
     // UI Logic
     document.querySelectorAll('.ai-tab-btn').forEach(btn => btn.classList.remove('active'));
     document.querySelectorAll('.ai-content').forEach(content => content.classList.remove('active'));

     const targetBtn = document.querySelector(`.ai-tab-btn[onclick="switchAiTab('${tabName}')"]`);
     const targetContent = document.getElementById(`ai-tab-${tabName}`);

     if (targetBtn) targetBtn.classList.add('active');
     if (targetContent) targetContent.classList.add('active');

     // Clear result
     const resultArea = document.getElementById('ai-result');
     if (resultArea) {
          resultArea.classList.remove('show');
          resultArea.style.display = 'none';
          resultArea.innerHTML = '';
     }
}

window.toggleIngredient = function (el, ing) {
     if (selectedIngredients.has(ing)) {
          selectedIngredients.delete(ing);
          el.classList.remove('selected');
     } else {
          selectedIngredients.add(ing);
          el.classList.add('selected');
     }
}

window.runAiChef = function () {
     if (selectedIngredients.size === 0) {
          alert("재료를 선택해주세요! (장바구니 셰프)");
          return;
     }

     showAiLoading();

     // Mock AI Processing - Enhanced Logic
     setTimeout(() => {
          const ingredients = Array.from(selectedIngredients);
          let recipe = {};

          // Helper to check ingredients
          const has = (ing) => ingredients.includes(ing);

          if (has('sinsam') && has('honey')) {
               recipe = {
                    title: "기력 회복 꿀삼 라떼",
                    desc: "피곤한 하루, 개성인삼과 DMZ 꿀의 만남. 따뜻한 우유에 인삼을 갈아 넣고 꿀을 더해 부드럽고 달콤하게 즐기세요.",
                    tags: ["소요시간: 15분", "난이도: 쉬움"],
                    tip: "우유 거품을 내어 올리면 카페 메뉴 부럽지 않아요. 시나몬 가루를 살짝 뿌려도 좋습니다.",
                    matchProduct: "p5"
               };
          } else if (has('bean') && has('rice')) {
               recipe = {
                    title: "장단콩 콩나물 솥밥",
                    desc: "아삭한 콩나물과 고소한 장단콩 두부, 윤기 흐르는 한수위 쌀의 조화. 양념장에 비벼 먹으면 다른 반찬이 필요 없는 건강 밥상입니다.",
                    tags: ["소요시간: 40분", "난이도: 보통"],
                    tip: "콩나물은 밥이 뜸 들 때 넣어야 아삭한 식감이 살아납니다.",
                    matchProduct: "p6"
               };
          } else if (has('wine')) {
               recipe = {
                    title: "산머루 와인 스테이크 소스",
                    desc: "집에서도 레스토랑처럼! 산머루 와인을 졸여 만든 특제 소스. 깊은 풍미가 스테이크의 맛을 한층 품격 있게 만들어줍니다.",
                    tags: ["소요시간: 20분", "난이도: 보통"],
                    tip: "와인을 끓일 때 양파와 마늘을 함께 볶으면 풍미가 더욱 깊어집니다.",
                    matchProduct: "p3"
               };
          } else if (has('bean')) {
               recipe = {
                    title: "장단콩 두부 샐러드",
                    desc: "장단콩으로 만든 담백한 두부와 신선한 채소의 만남. 가벼우면서도 든든한 한 끼로 제격입니다.",
                    tags: ["소요시간: 15분", "난이도: 쉬움"],
                    tip: "오리엔탈 드레싱이나 참깨 드레싱과 잘 어울립니다.",
                    matchProduct: "p1"
               };
          } else if (has('yam') && has('honey')) {
               recipe = {
                    title: "장단 마 꿀쥬스",
                    desc: "아침 대용으로 최고! 장단 마와 꿀, 우유를 갈아 만든 영양 만점 주스. 위를 보호하고 에너지를 충전해줍니다.",
                    tags: ["소요시간: 5분", "난이도: 매우 쉬움"],
                    tip: "마의 끈적한 식감이 부담스럽다면 꿀을 넉넉히 넣거나 바나나를 함께 갈아보세요.",
                    matchProduct: "p8"
               };
          } else if (has('yam')) {
               recipe = {
                    title: "장단 마 전",
                    desc: "감자전보다 더 고소하고 쫀득하다! 강판에 간 마에 부침가루를 섞어 노릇하게 구워낸 별미.",
                    tags: ["소요시간: 20분", "난이도: 보통"],
                    tip: "청양고추를 썰어 넣으면 매콤한 맛이 더해져 더욱 맛있습니다.",
                    matchProduct: "p8"
               };
          } else if (has('sinsam')) {
               recipe = {
                    title: "개성인삼 삼계탕",
                    desc: "더위야 물러가라! 개성인삼 한 뿌리를 통째로 넣은 보양식. 진한 국물과 부드러운 닭고기가 지친 몸에 활력을 불어넣어 줍니다.",
                    tags: ["소요시간: 60분", "난이도: 어려움"],
                    tip: "대추와 마늘을 듬뿍 넣으면 국물 맛이 더욱 깊어집니다.",
                    matchProduct: "p5"
               };
          } else {
               recipe = {
                    title: "로컬 푸드 비빔밥",
                    desc: "냉장고 속 자투리 채소와 로컬 식재료의 화려한 변신. 고추장 양념에 쓱쓱 비벼 먹으면 꿀맛 보장!",
                    tags: ["소요시간: 20분", "난이도: 쉬움"],
                    tip: "계란 프라이는 반숙으로! 노른자를 터뜨려 비벼 먹으면 더욱 고소합니다.",
                    matchProduct: "p6"
               };
          }

          renderAiResult(recipe, 'chef');
     }, 1500);
}

window.runAiGift = function () {
     const target = document.getElementById('gift-target').value;
     const occasion = document.getElementById('gift-occasion').value;

     if (!target || !occasion) {
          alert("선물 대상과 상황을 모두 선택해주세요.");
          return;
     }

     showAiLoading();

     setTimeout(() => {
          let recItem = 'p1';
          let reason = "";

          // Simple Recommendation Logic
          if (target === 'parents' || occasion === 'health') {
               recItem = 'p5'; // 인삼
               reason = "부모님의 건강을 생각하는 마음, 면역력 강화에 으뜸인 '6년근 파주 개성인삼'을 추천합니다.";
          } else if (target === 'couple' || occasion === 'party') {
               recItem = 'p3'; // 와인
               reason = "로맨틱한 분위기에는 달콤하고 깊은 풍미의 '산머루 와인'이 제격이죠. 특별한 날을 더욱 빛내줄 거예요.";
          } else if (target === 'kids' || occasion === 'snack') {
               recItem = 'c1'; // 롤케이크
               reason = "아이들도 좋아하는 부드러운 맛! 글루텐 프리라 소화도 잘 되는 '장단콩 비건 롤케이크'입니다.";
          } else if (target === 'friend') {
               recItem = 'c5'; // 약과
               reason = "요즘 핫한 할매니얼 디저트! 달콤한 조청과 고소한 콩배기, 퓨전 약과로 센스 있는 친구가 되어보세요.";
          } else {
               recItem = 'e2'; // 글램핑 (Anything else)
               reason = "특별한 추억을 선물하고 싶다면? 쏟아지는 별빛 아래 낭만적인 캠핑을 즐길 수 있는 '글램핑' 체험권을 추천합니다.";
          }

          const product = globalProducts.find(p => p.id === recItem) || globalProducts[0];

          const resultData = {
               title: `Best Choice for You: ${product.name}`,
               desc: reason,
               matchProduct: product.id
          };

          renderAiResult(resultData, 'gift');

     }, 1500);

}

function showAiLoading() {
     document.getElementById('ai-loading').style.display = 'block';
     const resultArea = document.getElementById('ai-result');
     resultArea.style.display = 'none';
     resultArea.classList.remove('show');
}

function renderAiResult(data, type) {
     document.getElementById('ai-loading').style.display = 'none';
     const resultArea = document.getElementById('ai-result');
     const product = globalProducts.find(p => p.id === data.matchProduct);

     console.log("Rendering AI Result:", data, product); // Debug

     let tagsHtml = '';
     if (data.tags && data.tags.length > 0) {
          tagsHtml = `<div style="display:flex; justify-content:center; gap:10px; margin-bottom:15px;">
            ${data.tags.map(tag => `<span style="background:#f0f0f0; padding:4px 10px; border-radius:12px; font-size:0.8rem; color:#555;">${tag}</span>`).join('')}
        </div>`;
     }

     let tipHtml = '';
     if (data.tip) {
          tipHtml = `<div style="background:#fff8e1; color:#5d4037; padding:15px; border-radius:8px; margin-bottom:25px; font-size:0.95rem; border:1px solid #ffe0b2; text-align:left;">
            <i class="fas fa-lightbulb" style="color:#ffb74d; margin-right:8px;"></i> <strong>Chef's Tip:</strong> ${data.tip}
        </div>`;
     }

     let html = `
        <div style="text-align: center;">
             <div style="background: var(--color-primary); color: white; display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; margin-bottom: 15px; font-weight: 700;">
                  AI RECOMMENDATION
             </div>
             <h3 style="font-size: 1.6rem; margin-bottom: 10px; font-family: var(--font-serif); color: #333;">${data.title}</h3>
             ${tagsHtml}
             <p style="color: #666; margin-bottom: 25px; line-height: 1.6; padding: 0 20px; font-size:1.05rem;">${data.desc}</p>
             ${tipHtml}
             
             ${product ? `
             <div style="display: flex; align-items: center; background: #f9f9f9; padding: 20px; border-radius: 12px; text-align: left; max-width: 500px; margin: 0 auto; box-shadow: 0 4px 10px rgba(0,0,0,0.03);">
                  <img src="${product.image}" style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px; margin-right: 20px;">
                  <div>
                       <div style="font-size: 0.8rem; color: #888; margin-bottom: 2px;">AI가 선택한 매칭 상품</div>
                       <div style="font-weight: 700; margin-bottom: 4px; font-size:1rem;">${product.name}</div>
                       <div style="color: var(--color-primary-dark); font-weight: 700;">${formatPrice(product.price)}</div>
                  </div>
                  <a href="#" class="btn btn-outline" style="margin-left: auto; padding: 8px 16px; font-size: 0.85rem; border-color:#ccc; color:#333; background:white;">담기</a>
             </div>
             ` : ''}
        </div>
    `;

     resultArea.innerHTML = html;
     resultArea.style.display = 'block';

     // Trigger animation
     setTimeout(() => {
          resultArea.classList.add('show');
     }, 10);
}

// Override the existing changeLanguage to include renderApp
window.changeLanguage = function changeLanguage(lang) {
     currentLang = lang;
     localStorage.setItem('preferredLang', lang); // Save preference
     const t = translations[lang];

     // Apply translations to DOM elements with data-i18n attributes
     document.querySelectorAll('[data-i18n]').forEach(el => {
          const key = el.getAttribute('data-i18n');
          if (t[key]) {
               el.innerHTML = t[key];
          }
     });

     // Update dropdown label and active state
     const labels = { ko: 'KOREAN', en: 'ENGLISH', jp: 'JAPANESE', cn: 'CHINESE' };
     const labelEl = document.getElementById('current-lang-label');
     if (labelEl) labelEl.innerText = labels[lang];

     // Update active class in dropdown
     document.querySelectorAll('.lang-item').forEach(btn => {
          btn.classList.remove('active');
          if (btn.getAttribute('onclick') && btn.getAttribute('onclick').includes(lang)) {
               btn.classList.add('active');
          }
     });

     // Re-render dynamic content
     renderApp();
}

// Auth Logic
function checkAuth() {
     const userStr = localStorage.getItem('localeat_user');
     if (userStr) {
          const authButtons = document.querySelector('.auth-buttons');
          if (authButtons) {
               authButtons.innerHTML = `
                    <a href="mypage.html" class="btn btn-outline" style="border-color: rgba(255,255,255,0.5); color: white; padding: 8px 16px; font-size: 0.9rem;">마이페이지</a>
                    <button onclick="logout()" class="btn btn-primary" style="background: var(--color-accent); color: var(--color-primary-dark); padding: 8px 16px; font-size: 0.9rem; border:none; cursor:pointer;">로그아웃</button>
               `;
          }
     }
}

window.logout = function () {
     if (confirm('정말 로그아웃 하시겠습니까?')) {
          localStorage.removeItem('localeat_user');
          window.location.href = 'index.html';
     }
}

document.addEventListener('DOMContentLoaded', async () => {
     // 1. Header is now static in HTML for i18n
     initHeader();
     checkAuth();

     // Language Switcher Toggle
     const langWrapper = document.querySelector('.lang-dropdown-wrapper');
     const langBtn = document.querySelector('.lang-btn');

     if (langWrapper && langBtn) {
          langBtn.addEventListener('click', (e) => {
               e.stopPropagation();
               langWrapper.classList.toggle('active');
          });

          // Close on click outside
          document.addEventListener('click', () => {
               langWrapper.classList.remove('active');
          });
     }

     // Weather logic


     // --- Weather Widget Logic ---
     const weatherCodeMap = {
          0: { icon: 'fa-sun', desc: '맑음' },
          1: { icon: 'fa-cloud-sun', desc: '대체로 맑음' },
          2: { icon: 'fa-cloud', desc: '구름 많음' },
          3: { icon: 'fa-cloud', desc: '흐림' },
          45: { icon: 'fa-smog', desc: '안개' },
          48: { icon: 'fa-smog', desc: '안개' },
          51: { icon: 'fa-cloud-rain', desc: '이슬비' },
          53: { icon: 'fa-cloud-rain', desc: '이슬비' },
          55: { icon: 'fa-cloud-rain', desc: '이슬비' },
          61: { icon: 'fa-umbrella', desc: '비' },
          63: { icon: 'fa-umbrella', desc: '비' },
          65: { icon: 'fa-umbrella', desc: '비' },
          71: { icon: 'fa-snowflake', desc: '눈' },
          73: { icon: 'fa-snowflake', desc: '눈' },
          75: { icon: 'fa-snowflake', desc: '눈' },
          80: { icon: 'fa-cloud-showers-heavy', desc: '소나기' },
          81: { icon: 'fa-cloud-showers-heavy', desc: '소나기' },
          82: { icon: 'fa-cloud-showers-heavy', desc: '소나기' },
          95: { icon: 'fa-bolt', desc: '뇌우' },
          96: { icon: 'fa-bolt', desc: '뇌우, 우박' },
          99: { icon: 'fa-bolt', desc: '뇌우, 우박' }
     };

     const dayNames = ['일', '월', '화', '수', '목', '금', '토'];

     async function initWeather() {
          try {
               // Fetch Paju (Geumchon-dong) weather: Lat 37.7608, Lon 126.7735
               const response = await fetch('https://api.open-meteo.com/v1/forecast?latitude=37.7608&longitude=126.7735&current=temperature_2m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=Asia%2FSeoul');
               const data = await response.json();

               if (data && data.current) {
                    // Update Main Widget
                    const currentTemp = Math.round(data.current.temperature_2m);
                    const currentCode = data.current.weather_code;
                    const weatherInfo = weatherCodeMap[currentCode] || { icon: 'fa-cloud', desc: '흐림' };

                    document.getElementById('weather-temp-main').innerText = `${currentTemp}°C`;
                    document.getElementById('weather-icon-main').className = `fas ${weatherInfo.icon}`;

                    // Build Weekly Forecast
                    if (data.daily) {
                         const listEl = document.getElementById('weekly-forecast-list');
                         listEl.innerHTML = ''; // Clear loading

                         // Loop through 5 days
                         for (let i = 0; i < 5; i++) {
                              const dateStr = data.daily.time[i];
                              const dateObj = new Date(dateStr);
                              const dayName = dayNames[dateObj.getDay()];
                              const maxTemp = Math.round(data.daily.temperature_2m_max[i]);
                              const minTemp = Math.round(data.daily.temperature_2m_min[i]);
                              const code = data.daily.weather_code[i];
                              const icon = (weatherCodeMap[code] || { icon: 'fa-cloud' }).icon;

                              const itemHtml = `
                        <div class="forecast-item">
                            <span class="forecast-day">${i === 0 ? '오늘' : dayName}</span>
                            <div class="forecast-icon"><i class="fas ${icon}"></i></div>
                            <span class="forecast-temp">${minTemp}° / ${maxTemp}°</span>
                        </div>
                    `;
                              listEl.insertAdjacentHTML('beforeend', itemHtml);
                         }
                    }
               }
          } catch (error) {
               console.error('Weather fetch error:', error);
               document.getElementById('weather-temp-main').innerText = '--';
          }
     }

     window.toggleWeather = function () {
          const popup = document.getElementById('weather-popup');
          popup.classList.toggle('active');
     }

     // Close popup when clicking outside
     document.addEventListener('click', function (event) {
          const header = document.querySelector('.weather-container');
          const popup = document.getElementById('weather-popup');
          if (!header.contains(event.target) && popup.classList.contains('active')) {
               popup.classList.remove('active');
          }
     });

     // Initialize Weather
     initWeather();

     const savedLang = localStorage.getItem('preferredLang');
     if (savedLang && translations[savedLang]) {
          changeLanguage(savedLang);
     } else {
          changeLanguage('ko');
     }

     // Initial Fetch and Render
     await fetchData();
});
